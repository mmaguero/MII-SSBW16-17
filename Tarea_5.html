<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Entrada de datos</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/prism.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/components/prism-markup.min.js"></script>
<style>
p {text-indent: 0em;
   font-size: 120%;
   margin-top: 2em;
  }
</style>
</head>
<body>
<div class="container">
   <br>
   <h2>Entrada de datos con formularios</h2>
<p>
   En esta tarea usaremos la clase <a href="https://docs.djangoproject.com/en/1.10/topics/forms/">Forms</a> de Django
   para añadir datos. Incluiremos también una foto del restaurante aprovechando el tipo de campo
   <a href="http://docs.mongoengine.org/apireference.html#mongoengine.fields.ImageField">ImageField</a>, de
   mongoengine. <span style="color:grey">(Para usarlo hay que instalar la librería <a href="https://python-pillow.org/">pillow</a>)</span>
</p>
<p>
También haremos una página de detalle con los datos de cada restaurante, incluyendo la foto, a la que se acceda:
<pre><code class="language-bash" data-lang="bash">
   http://localhost:8000/restaurante/nombre_del_restaurante

   ó mejor

   http://localhost:8000/restaurante/restaurante_id  (que debe ser único)
</code></pre>
Django <a href="https://docs.djangoproject.com/en/1.10/topics/http/urls/#named-groups">URL dispatcher</a>
</p>
<br /><br />
<h3>Pasos:</h3>
<p>
   1.- Hacer un form compatble con la clase de mongoengine, que incluya algún validador y subir una imagen
</p>
<p>
   2.- A la vuelta del form, tener en cuenta la <a href="https://docs.djangoproject.com/en/1.10/topics/http/file-uploads/">subida de archivos</a> en el formulario
   (<a href="https://docs.djangoproject.com/en/1.10/ref/forms/api/#binding-uploaded-files">Binding uploaded files to a form</a>), y
   que haya un campo de clave única en la BD (puede ser <i>restaurant_id</i> o el nombre).
   Para guardar la imágen en mongo, simplemente:
   <pre><code class="language-python" data-lang="python">
      restaruante = restaurants(
         name = form.cleaned_data.get('name')  # después de validar
         ...
         foto = request.FILES.get('foto')
      )
   </code></pre>
</p>

<p>
   3.- Hacer una salida con los datos cada restaurante. Para leer la imágen de la BD:
   <a href="http://docs.mongoengine.org/guide/gridfs.html#gridfs">GridFs</a>
</p>
<p>
   Para que quede mejor, se puede utilizar <a href="https://github.com/GabrielUlici/django-bootstrap4">
   django-boostrap4</a> o similar
</p>

</div>
<br /><br />

</body>
</html>
